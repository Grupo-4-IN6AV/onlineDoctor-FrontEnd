<section class="content">
  <!--TÍTULO DEL COMPONENTE-->
  <div *ngIf="!invoiceShow" class="head-title">
    <div class="left">
      <h1>
        &nbsp;<i class="fa fa-shopping-cart" aria-hidden="true"></i> Detalles del Carrito
      </h1>
      <hr>
    </div>
  </div>

  <div *ngIf="invoiceShow" class="head-title">
    <div class="left">
      <h1>
        &nbsp;<i class="fa fa-file" aria-hidden="true"></i> Tu Factura
      </h1>
      <hr>
    </div>
  </div>

  <div *ngIf="!invoiceShow" class="container py-5 h-100">
    <div class="row d-flex justify-content-center align-items-center h-100">
      <div class="col">
        <div class="card">
          <div class="card-body p-4">

            <div class="row">

              <div class="col-lg-7">
                <div class="d-flex justify-content-between align-items-center mb-4">
                  <div>
                    <p class="mb-1">Carrito de Compras</p>
                    <p class="mb-0">Tienes {{items}} medicamentos en tu carrito.</p>
                  </div>
                </div>

                <div style="background-color: #e5e5e5e5;" *ngFor="let medicament of medicamentsCart" class="card mb-3">
                  <div class="card-body">
                    <div class="d-flex justify-content-between">
                      <div class="d-flex flex-row align-items-center">
                        <div>
                          <img *ngIf="medicament.medicament.image===undefined"
                            src="../../../../assets/images/usrbig.jpg" class="img-fluid rounded-3" alt="Shopping item"
                            style="width: 65px;">
                          <img *ngIf="medicament.medicament.image!==undefined"
                            src="{{uriMedicament+medicament.medicament.image}}" class="img-fluid rounded-3"
                            alt="Shopping item" style="width: 65px;  height: 65px; object-fit: cover;"
                            crossorigin="anonymous">
                        </div>
                        <div class="ms-3">
                          <h5>{{medicament.medicament.name}}</h5>
                          <p class="small mb-0">{{medicament.quantity}} unidades.</p>
                        </div>
                      </div>
                      <div class="d-flex flex-row align-items-center">
                        <div style="width: 50px;">
                          <h5 class="fw-normal mb-0">{{medicament.quantity}}</h5>
                        </div>
                        <div style="width: 80px;">
                          <h5 class="mb-0">Q.{{medicament.price.toFixed(2)}}</h5>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-lg-5">

                <div class="card colorDetails text-white rounded-3">
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                      <h5 class="mb-0">Detalles de tu Compra</h5>
                      <img *ngIf="!userImage" src="../../../../assets/images/usrbig.jpg" class="img-fluid rounded-3" style="width: 45px;"
                        alt="Avatar">
                        <img *ngIf="userImage" src="{{uriUser}}" class="img-fluid rounded-3" style="width: 45px;" crossorigin="anonymous"
                        alt="Avatar">
                    </div>

                    <form class="mt-4">
                      <div class="form-outline form-white mb-4">
                        <input [(ngModel)]="userCart.name" name="clientName" disabled type="text" id="typeName"
                          class="form-control form-control-lg" siez="17">
                        <label class="form-label" for="typeName">Nombre:</label>
                      </div>

                      <div class="form-outline form-white mb-4">
                        <input *ngIf="!userCart.DPI" value="-Sin DPI-" name="clientDPI" disabled type="text"
                          id="typeName" class="form-control form-control-lg" siez="17">
                        <input *ngIf="userCart.DPI" [(ngModel)]="userCart.DPI" name="clientDPI" disabled type="text"
                          id="typeName" class="form-control form-control-lg" siez="17">
                        <label class="form-label" for="typeText">DPI:</label>
                      </div>

                      <div class="form-outline form-white mb-4">
                        <input [(ngModel)]="userCart.NIT" name="clientNIT" disabled type="text" id="typeName"
                          class="form-control form-control-lg" siez="17">
                        <label class="form-label" for="typeText">NIT:</label>
                      </div>
                    </form>

                    <hr class="my-4">

                    <div class="d-flex justify-content-between">
                      <p class="mb-2">SubTotal</p>
                      <p class="mb-2">Q.{{dataBuy.subTotal.toFixed(2)}}</p>
                    </div>

                    <div class="d-flex justify-content-between">
                      <p class="mb-2">IVA</p>
                      <p class="mb-2">Q.{{dataBuy.IVA.toFixed(2)}}</p>
                    </div>

                    <div class="d-flex justify-content-between mb-4">
                      <p class="mb-2"><b>Total</b></p>
                      <p class="mb-2"><b>Q.{{dataBuy.total.toFixed(2)}}</b></p>
                    </div>

                    <div class="d-flex" style="justify-content: center">
                      <button (click)="payShoppingCart()" style="background-color: orange" class="btn btn-icon-split">
                        <span class="icon">
                          <i class="fa fa-file" aria-hidden="true"></i>
                        </span>
                        <span class="text">Finalizar Compra</span>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="invoiceShow" class="text-center mt-2 mb-2">
    <button routerLink="/paciente/pharmacy" type="button"
        class="ms-3 btn btn-event btn-secondary">
        Regresar a Farmacia
        <span class="btn-icon-end"><i class="fa-solid fa-prescription-bottle-medical"></i> </span>
    </button>
    <button routerLink="/paciente/home" type="button" class="ms-3 btn btn-event btn-dark">
        Inicio
        <span class="btn-icon-end"><i class="fas fa-home"></i> </span>
    </button>
</div>
<hr *ngIf="invoiceShow" />
  <div *ngIf="invoiceShow" class="container-fluid">
    <div class="row clearfix">
      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <div class="card">
          <div class="body">
            <div class="row">
              <div class="col-md-12">
                <div class="white-box">
                  <h3>
                    <b>Factura</b>
                    <span class="float-end">#{{invoice.numberBill+1000}}</span>
                  </h3>
                  <hr>
                  <div class="row">
                    <div class="col-md-12">
                      <div class="float-start">
                        <address>
                          <p class="font-bold">Remitente :</p>
                          <p class="text-muted">
                            Online Doctor,
                            <br> Guatemala,
                            <br> Ciudad de Guatemala,
                            <br> Año 2022.
                          </p>
                        </address>
                      </div>
                      <div class="float-end text-end">
                        <address>
                          <p class="addr-font-h3 font-bold">Receptor :</p>
                          <p class="font-bold addr-font-h4">Rodrigo Cárdenas</p>
                          <p class="text-muted m-l-30">
                            <br> 18 años,
                            <br> 55798278,
                            <br> rcardenas
                          </p>
                          <p class="m-t-30">
                            <b>Fecha :</b>
                            <i class="fa fa-calendar"></i> {{setDate}}
                          </p>
                          <p>
                            <b>Estado :</b> &nbsp;
                            <span class="label label-success">Facturada</span>
                          </p>
                        </address>
                      </div>
                    </div>
                    <div class="col-md-12">
                      <div class="table-responsive m-t-40">
                        <table class="table table-hover">
                          <thead>
                            <tr>
                              <th class="text-center">#</th>
                              <th class="text-center">Medicamento</th>
                              <th class="text-center">Cantidad</th>
                              <th class="text-center">Costo Unitario</th>
                              <th class="text-end">SubTotal</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr *ngFor="let medicament of invoice.medicaments">
                              <td class="text-center">{{invoice.medicaments.indexOf(medicament)+1}}</td>
                              <td class="text-center">{{medicament.name}}</td>
                              <td class="text-center" *ngIf="medicament.quantity === 1">
                                {{medicament.quantity}} unidad
                              </td>
                              <td class="text-center" *ngIf="medicament.quantity !== 1">
                                {{medicament.quantity}} unidades
                              </td>
                              <td class="text-center">Q.{{medicament.price.toFixed(2)}}</td>
                              <td class="text-end">Q.{{medicament.subTotalMedicament.toFixed(2)}}</td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                    <div class="col-md-12">
                      <div class="float-end m-t-30 text-end">
                        <p>SubTotal: Q.{{invoice.subTotal.toFixed(2)}}</p>
                        <p>IVA (12%): Q.{{invoice.IVA.toFixed(2)}}</p>
                        <hr>
                        <h3>
                          <b>Total :</b> Q.{{invoice.total.toFixed(2)}}</h3>
                      </div>
                      <div class="clearfix"></div>
                      <hr>
                      <div class="text-end">
                        <button (click)="imprimir()" mat-raised-button color="primary"><i class="fas fa-print msr-2"></i>Imprimir</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
